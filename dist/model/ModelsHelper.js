sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","plants/tagger/ui/customClasses/MessageUtil","plants/tagger/ui/customClasses/Util","sap/m/MessageToast"],function(e,t,o,s,n){"use strict";var r;var a=e.extend("plants.tagger.ui.model.ModelsHelper",{constructor:function(e){this._component=e;this._component.getModel("plants").attachRequestCompleted(this._onReceivingPlantsFromBackend.bind(this));this._component.getModel("plants").attachRequestFailed(this.onReceiveErrorGeneric.bind(this,"Plants Model"));this._component.getModel("taxon").attachRequestCompleted(this._onReceivingTaxaFromBackend.bind(this));this._component.getModel("taxon").attachRequestFailed(this.onReceiveErrorGeneric.bind(this,"Taxon Model"))},onReceiveErrorGeneric:function(e,t,r,a){s.stopBusyDialog();if(!!t&&!!t.responseJSON&&!!t.responseJSON.detail&&!!t.responseJSON.detail.type){o.getInstance().addMessageFromBackend(t.responseJSON.detail);n.show(t.responseJSON.detail.type+t.responseJSON.detail.message);return}if(t&&t.hasOwnProperty("responseJSON")&&typeof t.responseJSON==="string"){var i="Error: "+t.status+" "+t.responseJSON}else if(t&&t.hasOwnProperty("responseJSON")&&t.responseJSON&&"error"in t.responseJSON){i="Error: "+t.status+" "+t.responseJSON["error"]}else if(t&&t.getParameter&&!!t.getParameter("responseText")&&typeof JSON.parse(t.getParameter("responseText"))==="object"){var c=t.getParameters();i="Error: "+c.statusCode+" "+JSON.parse(c.responseText).error}else if(!!t.status&&!!t.statusText){i="Error at: "+e+" - Status: "+t.status+" "+t.statusText}else{i="Error at: "+e}n.show(i);o.getInstance().addMessage("Error",i,undefined,undefined)},_onReceivingPlantsFromBackend:function(e){this._component.oPlantsDataClone=s.getClonedObject(e.getSource().getData());var t=s.parse_resource_from_url(e.getParameter("url"));o.getInstance().addMessage("Information","Loaded Plants from backend",undefined,"Resource: "+t)},_onReceivingTaxaFromBackend:function(e){this._component.oTaxonDataClone=s.getClonedObject(e.getSource().getData());var t=s.parse_resource_from_url(e.getParameter("url"));o.getInstance().addMessage("Information","Loaded Taxa from backend",undefined,"Resource: "+t)},reloadPlantsFromBackend:function(){var e=s.getServiceUrl("plants/");this._component.getModel("plants").loadData(e);s.stopBusyDialog()},resetImagesRegistry:function(){this._component.imagesRegistry={};this._component.imagesRegistryClone={};this._component.imagesPlantsLoaded=new Set;this._component.getModel("images").updateBindings();this._component.getModel("untaggedImages").updateBindings()},addToImagesRegistry:function(e){e.forEach(e=>{var t=e["filename"];if(!(t in this._component.imagesRegistry)){this._component.imagesRegistry[t]=e}this._component.imagesRegistryClone[t]=s.getClonedObject(e)})},reloadTaxaFromBackend:function(){var e=s.getServiceUrl("taxa/");this._component.getModel("taxon").loadData(e)},reloadKeywordProposalsFromBackend:function(){var e=s.getServiceUrl("proposals/KeywordProposals");if(!this._component.getModel("keywords")){this._component.setModel(new t(e),"keywords")}else{this._component.getModel("keywords").loadData(e)}},reloadTraitCategoryProposalsFromBackend:function(){var e=s.getServiceUrl("proposals/TraitCategoryProposals");if(!this._component.getModel("trait_categories")){this._component.setModel(new t(e),"trait_categories")}else{this._component.getModel("trait_categories").loadData(e)}},reloadNurserySourceProposalsFromBackend:function(){var e=s.getServiceUrl("proposals/NurserySourceProposals");if(!this._component.getModel("nurseries_sources")){var o=new t(e);o.setSizeLimit(50);this._component.setModel(o,"nurseries_sources")}else{this._component.getModel("nurseries_sources").loadData(e)}},reloadPropertyNamesFromBackend:function(){var e=s.getServiceUrl("property_names/");if(!this._component.getModel("propertyNames")){var o=new t(e);o.setSizeLimit(300);this._component.setModel(o,"propertyNames")}else{this._component.getModel("propertyNames").loadData(e)}}});return{getInstance:function(e){if(!r){r=new a(e)}return r}}});