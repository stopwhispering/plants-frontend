<mvc:View 
	xmlns:mvc="sap.ui.core.mvc"
	displayBlock="true" 
	controllerName="plants.tagger.ui.controller.Detail" 
	height="100%"
	xmlns="sap.uxap"
	xmlns:m="sap.m"
	xmlns:l="sap.ui.layout"
	xmlns:f="sap.f"
	xmlns:core="sap.ui.core"
	xmlns:app="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
	class="sapUiSizeCompact">

	<ObjectPageLayout id="ObjectPageLayout"
		showTitleInHeaderContent="true"
		alwaysShowContentHeader="false"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="true"
		isChildPage="true"
		upperCaseAnchorBar="false">
		
		<headerTitle>
			<ObjectPageDynamicHeaderTitle>
				<expandedHeading>
					<m:Title 
						text="{plants>plant_name}" 
						level="H3"
						wrapping="true" 
						class="sapUiSmallMarginEnd"/>
				</expandedHeading>

				<snappedHeading>
					<m:FlexBox wrap="Wrap" fitContainer="true" alignItems="Center">
						<m:FlexBox wrap="NoWrap" fitContainer="true" alignItems="Center" class="sapUiTinyMarginEnd">
							<f:Avatar 
								src="{plants>url_preview}"
								displaySize="S"
								displayShape="Square">
							</f:Avatar>								
						<m:Title 
							level="H3"
							text="{plants>plant_name}" 
							wrapping="true" 
							class="sapUiTinyMarginEnd sapUiSmallMarginBegin"/>
						
						</m:FlexBox>
					</m:FlexBox>
				</snappedHeading>

				<actions>
					<m:OverflowToolbarButton
						icon="sap-icon://edit"
						id="buttonEdit"
						text="{i18n>edit_button}"
						tooltip="{i18n>edit_button_tooltip}"
						press="onToggleEditMode"
						type="Transparent"/>
					<m:OverflowToolbarButton
						icon="sap-icon://write-new-document"
						id="buttonRename"
						text="{i18n>rename_button}"
						tooltip="{i18n>rename_button_tooltip}"
						press=".onPressButtonRenamePlant($event, ${plants>plant_name})"
						type="Transparent"/>						
					<m:OverflowToolbarButton
						icon="sap-icon://delete"
						text="{i18n>delete_button}"
						tooltip="{i18n>delete_button_tooltip}"
						press=".onPressButtonDeletePlant($event, ${plants>plant_name})"
						type="Transparent"/>
					<m:OverflowToolbarButton 
						type="Transparent" 
						icon="sap-icon://full-screen" 
						press="handleFullScreen" 
						tooltip="{i18n>fullscreen_button_tooltip}" 
						visible="{= ${/actionButtonsInfo/midColumn/fullScreen} !== null }"/>
					<m:OverflowToolbarButton 
						type="Transparent" 
						icon="sap-icon://exit-full-screen" 
						press="handleExitFullScreen" 
						tooltip="{i18n>exit_fullscreen_button_tooltip}" 
						visible="{= ${/actionButtonsInfo/midColumn/exitFullScreen} !== null }"/>
					<m:OverflowToolbarButton 
						type="Transparent"
						icon="sap-icon://decline" 
						press="handleClose"  
						tooltip="{i18n>close_column}" 
						visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
				</actions>

			</ObjectPageDynamicHeaderTitle>
		</headerTitle>

		<headerContent>
			<m:FlexBox wrap="Wrap" fitContainer="true" alignItems="Stretch">
				<f:Avatar 
					src="{plants>url_preview}"
					  displaySize="L"
					  displayShape="Square"
					  class="sapUiTinyMarginEnd">
				</f:Avatar>
				<m:VBox justifyContent="Center" class="sapUiSmallMarginEnd">
					<m:Label text="{i18n>Id}"/>
					<m:Label text="{plants>id}"/>
				</m:VBox>
				<m:VBox justifyContent="Center" class="sapUiSmallMarginEnd">
					<!--todo: replace with taxon>name-->
					<m:Label text="{i18n>species}"/>
					<m:Text text="{plants>botanical_name} {plants>taxon_authors}"/>
				</m:VBox>
				<m:VBox 
					justifyContent="Center" 
					class="sapUiSmallMarginEnd"
					visible="true">
					<m:HBox alignItems="Center">
						<m:Label text="Tags"/>
						<m:Button 
								icon="sap-icon://tag"
								tooltip="Add Tag"
								type="Transparent"
								press="onOpenAddTagDialog"/>					
					</m:HBox>
					<m:HBox height="1.2em"
						items="{
							path: 'plants>tags',
							templateShareable: true
							}"
						wrap="Wrap">
						<m:items>
							<m:ObjectStatus
								text="{plants>text}"
								icon="{plants>icon}"
								state="{plants>state}"
								inverted="true"
								active="true"
								press=".onPressTag"
								/>										
						</m:items>
					</m:HBox>	

					
					
				</m:VBox>
				<m:VBox justifyContent="Center" class="sapUiSmallMarginEnd">
					<m:Label text="Notes"/>
					<m:Text text="{taxon>custom_notes}"/>
				</m:VBox>
			</m:FlexBox>
			
		</headerContent>

		<sections>
			
			<!--General-->
			<ObjectPageSection 
				title="General"
				id="objPageSectionGeneral">
				<subSections>
					<ObjectPageSubSection
						id="objPageSubSection">
						<blocks>
							<core:Fragment 
								fragmentName="plants.tagger.ui.view.fragments.DetailPlantInfos" 
								type="XML" />
							
 						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

			<!--Traits-->
			<ObjectPageSection 
				title="{i18n>traits}">
				
				<subSections>
					<ObjectPageSubSection>
						<blocks>	
						
							<core:Fragment 
								fragmentName="plants.tagger.ui.view.fragments.DetailTraits" 
								type="XML" />
								
						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>
			
			<!--Events-->
			<ObjectPageSection 
				title="{i18n>events_title}">
				<subSections>
					<ObjectPageSubSection>
						<blocks>
							
							<!--list is filled by generator function, see onInit()-->
							<m:List
								mode="{= (${status>/details_editable}) ? 'Delete' : 'None' }"
								delete="onDeleteEventsTableRow"
								id="eventsList"/>
							
						</blocks>
					</ObjectPageSubSection>
					<ObjectPageSubSection>
							<m:Button
								id="buttonAddMeasurement"
								text="{i18n>add}"
								type="Emphasized"
								press="openDialogAddMeasurement"/>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

			<!--Taxonomony-->
			<ObjectPageSection 
				title="{i18n>taxonomy}">
				
				<subSections>
					<ObjectPageSubSection>
						<blocks>	
							<core:Fragment 
								fragmentName="plants.tagger.ui.view.fragments.DetailTaxonomy" 
								type="XML" />
						</blocks>
					</ObjectPageSubSection>

					<ObjectPageSubSection>
						<blocks>	
							<core:Fragment 
								fragmentName="plants.tagger.ui.view.fragments.DetailTaxonomyImages" 
								type="XML" />								
						</blocks>
					</ObjectPageSubSection>		
					
					<!--Map-->
					<ObjectPageSubSection
						visible="{= ${taxon>distribution/native/}.length > 0 }">
						<blocks>	
							<core:Fragment 
								fragmentName="plants.tagger.ui.view.fragments.DetailTaxonomyMap" 
								type="XML" />								
						</blocks>
					</ObjectPageSubSection>		
					
				</subSections>
			</ObjectPageSection>
		

			<ObjectPageSection 
				title="Images">

				<subSections>
					<ObjectPageSubSection>
						<blocks>

							<m:List
					        	id="listImages"
						        class="uoMImgGrid"
						        showSeparators="Inner"
						        growing="false"
						        growingThreshold="10"
						        growingScrollToLoad="false"
						        items="{
									path: 'images>/ImagesCollection',
									templateShareable:true,
									filters : [
										{path : 'plant_name', operator : 'EQ', value1 : 'AtBeginningFilterOutEverything'}
										],
									sorter: {
										path: 'record_date_time',
										descending: true
										}
									}">
								
						        <m:CustomListItem>
		    						<l:Grid>
								        <m:HBox>
								        	
									        <m:Image
									        	densityAware="false" 
									        	src="{images>url_small}"
									        	width="100%">
									        	
									        	<m:detailBox>
													<m:LightBox>
														<m:LightBoxItem 
															imageSrc="{images>url_original}"
															alt="{plants>plant_name} ({images>record_date_time})"
															title="{plants>plant_name} ({images>record_date_time})"
															subtitle="{images>description}">
														</m:LightBoxItem>
													</m:LightBox>
												</m:detailBox>
												
											</m:Image>
											
											<m:VBox 
												height="7rem" 
												class="sapUiTinyMargin">
												
												<m:items>
													<core:Icon 
													   src="sap-icon://favorite"
												       size="1rem"
												       color="{ parts: ['images>url_original',
												    					'plants>url_preview'],
												    			formatter: '.formatter.colorByPreviewOrNot'
												    			}"
												       hoverColor="blue"
												       activeColor="blue"
											    	   tooltip="Set as preview Image"
												       press="onIconPressSetPreview">
														<core:layoutData>
															<m:FlexItemData growFactor="1" />
														</core:layoutData>
													</core:Icon>
														
													<core:Icon 
														src="sap-icon://delete"
												    	size="1rem"
												    	color="#000000" 
												    	hoverColor="red"
												    	activeColor="red"
												    	tooltip="Delete Image"
												    	press="onIconPressDeleteImage">
														<core:layoutData>
															<m:FlexItemData growFactor="1" />
														</core:layoutData>
													</core:Icon>
													
													<core:Icon 
														src="sap-icon://toaster-up"
												    	size="1rem"
												    	color="#000000"
												    	hoverColor="blue"
												    	activeColor="blue"
												    	tooltip="Assign to Event"
												    	press="onIconPressAssignImageToEvent">
														<core:layoutData>
															<m:FlexItemData growFactor="1" />
														</core:layoutData>
													</core:Icon>
													
													<core:Icon 
														src="sap-icon://tools-opportunity"
												    	size="1rem"
												    	color="#000000"
												    	hoverColor="blue"
												    	activeColor="blue"
												    	tooltip="Assign to taxon"
												    	press=".ImageToTaxon.onIconPressMoveImageToTaxon">
														<core:layoutData>
															<m:FlexItemData growFactor="1" />
														</core:layoutData>
													</core:Icon>												
													
												</m:items>
				
											</m:VBox>
											
											<m:layoutData>
												<l:GridData span="XL5 L5 M7 S12"/>
											</m:layoutData>	
										
										</m:HBox>
		
							            <m:VBox 
							            	class="productInfo" 
							            	width="100%" 
							            	alignItems="Stretch">
							            	
							            	<m:items>
								            
									            <m:VBox 
									            	justifyContent="Center" 
									            	class="sapUiMediumMarginEnd">
				
									            	<m:Label
										            	text='{i18n>desc}'/>
				
										            <m:TextArea 
										              class="productShortDescription" 
										              rows="2"
										              cols="35"
										              value="{images>description}" 
										              textAlign="Left"/>  
									            </m:VBox>
				
												<m:HBox>
													<m:Label
														text='{i18n>rec_date}'/>
										            
										            <m:Text 
										              class="sapUiSmallMarginBegin"
										              text="{= ${images>record_date_time}.substr(0,10) + ' ' + ${images>record_date_time}.substr(11,5) }" 
										              textAlign="Left" 
										              wrapping="false" />
										        </m:HBox>
										        
										        <m:FlexBox 
										        	alignItems="Start" 
										        	direction="Column"
										        	displayInline="false" 
										        	fitContainer="false" >	
										        	
										        	<m:HBox>
											        	<m:Label
											        		text="{i18n>plants}"
											        		labelFor="inputImageNewPlantName"/>
											        		
										        		<m:Tokenizer 
										        			class="sapUiSizeCompact"
										        			id="tokenizerPlants"
										        			tokenChange="onTokenizerTokenChange"
										        			app:type="plant"
															tokens="{
																path: 'images>plants', templateShareable: false,
																sorter: { path: 'text' }
															}">
										        			
															<m:Token
																key="{images>key}" 
																text="{images>text}"
																tooltip="{images>text}"
																selected="{
																	parts: [
																		{path:'images>key'},
																		{path:'plants>plant_name'}],
																	formatter: '.formatter.tokenFormat'
																 }"
																 press="onPressImagePlantToken"
																 />
																
														</m:Tokenizer>
													</m:HBox>

													<m:Input
														id="inputImageNewPlantName"
														suggestionItemSelected="onInputImageNewPlantNameSubmit"
														visible="true"
														value=""
														editable="true"
														enabled="true"
														autocomplete="false"
														textAlign="Begin"
														type="Text"
														placeholder="{i18n>add_plants}"
														showSuggestion="true"
														showTableSuggestionValueHelp="false"
														width="18rem"
														suggestionRows="{
															path: 'plants>/PlantsCollection', templateShareable: false
															}">
														
														<m:suggestionColumns>
															<m:Column
																hAlign="Begin"
																popinDisplay="Inline"
																demandPopin="true">
																<m:Label text="{i18n>name}"/>
															</m:Column>
															<m:Column
																hAlign="End"
																demandPopin="false"
																minScreenWidth="Tablet">
																<m:Label text="{i18n>species}"/>
															</m:Column>
														</m:suggestionColumns>
														
														<m:suggestionRows>
															<m:ColumnListItem>
																<m:cells>
																	<m:Label text="{plants>plant_name}"/>
																	<m:Label text="{plants>species}"
																		wrapping="true"/>
																</m:cells>
															</m:ColumnListItem>
														</m:suggestionRows>
													</m:Input>
												</m:FlexBox>
				
												<m:FlexBox alignItems="Start" 
										        		   direction="Column"
										        		   displayInline="false" 
										        		   fitContainer="false" >			
												
													<m:HBox>
														<m:Label
											        		text="{i18n>keywords}"
											        		labelFor="inputImageNewKeyword"/>
											        		
										        		<m:Tokenizer 
										        			class="sapUiSizeCompact"
										        			width="100%"
										        			tokenChange="onTokenizerTokenChange"
										        			app:type="keyword"
															tokens="{
																path: 'images>keywords', templateShareable: false,
																sorter: { path: 'keyword' }
															}">
															<m:Token
																key="{images>keyword}" 
																text="{images>keyword}"
																tooltip="{images>keyword}"/>
														</m:Tokenizer>
														
													</m:HBox>
														
													<m:Input
														width="18rem"
														id="inputImageNewKeyword"
														submit="onInputImageNewKeywordSubmit"
														visible="true"
														value=""
														suggestionItems="{
															path: 'keywords>/KeywordsCollection',
															templateShareable: false
															}"
														editable="true"
														enabled="true"
														textAlign="Begin"
														type="Text"
														placeholder="Add Keywords"
														showSuggestion="true">
														<m:suggestionItems>
															<core:Item text="{keywords>keyword}"/>
														</m:suggestionItems>
													</m:Input>
				
								        		</m:FlexBox>
											</m:items>
											
											<m:layoutData>
												<l:GridData span="XL7 L5 M5 S12"/>
											</m:layoutData>	
											
					        			</m:VBox>
							    
									</l:Grid>
					        	</m:CustomListItem>
							</m:List>

						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

		</sections>
	</ObjectPageLayout>
</mvc:View>